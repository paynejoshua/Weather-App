<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stylesheet.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href='https://css.gg/search.css' rel='stylesheet'>

    <title>Weather App</title>
</head>
<body>
    <section>
        <div class="w3-row">
        <h1 class="header w3-col">Weather</h1>
    </div>


    <div class="container">
        
        <div class="w3-row-padding">
            
        <form id="search-fields">
            <input class="w3-col-4 w3-row-padding w3-mobile locationSearch" id="city-search" type="text" placeholder="City" value="Kirkland"> 
            <input class="w3-col-4 w3-row-padding w3-mobile locationSearch" id="state-search" type="text" placeholder="State Code" value="WA" > 
            <input class="w3-col-4 w3-row-padding w3-mobile locationSearch" id="country-search" type="text" placeholder="Country Code" value="us" > 
        </form> 
            <div>
            <i class="gg-search"></iclass></i>
            <button id="searchBtn">Search</button>
        </div>
            
                <div class="w3-half w3-cell-bottom forecast">
                    <p>5 day forecast</p>
                    
                </div>

                <div class="w3-quarter w3-row-padding w3-mobile current"  id="current-weather">Current Weather Conditions:</div>
                <div class="w3-quarter w3-row-padding w3-mobile searched" id="searched-cities">Previous</div>
           
            </div>

            
            
         </div>

       
        
        
</div>
    
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script type="text/JavaScript">
let date = new Date()
let todaysDate = date.getMonth() + "/" + date.getDate() + "/" + date.getFullYear()



$("#searchBtn").on("click", function(event){
event.preventDefault();
let city = $("#city-search").val();

let state = $("#state-search").val();

let country = $("#country-search").val();

let searchKey = city + "," + state + "," + country

let APIKey = "a4a8fbe7c144be93020e3a7f15b622db"


let forecastURL = `https://api.openweathermap.org/data/2.5/forecast?q=${searchKey}&appid=${APIKey}`;

// create container div 

$.ajax({
      url: forecastURL,
      method: "GET"
      
    })
      .then(function(response1) {

        // console.log(forecastURL);

        console.log(response1);

        $(".forecast").empty()
        $("#current-weather").empty()
        
        // this will give me an average out of the next 5 days.
        for (let i = 0; i < response1.list.length; i+=8) {

            

           let hourlyForecast =  response1.list[i].weather[0];
            
            let localDate = new Date(response1.list[i].dt * 1000).toLocaleDateString();

            // this sets the five day forecast
            console.log(response1.list[i]);
            let forecastDate = $("<label>");
                forecastDate.text(localDate)

            let forecastImg = $("<img>")
                let weatherIcon = `http://openweathermap.org/img/wn/${hourlyForecast.icon}@2x.png`;
                forecastImg.attr("src", weatherIcon);

            
            let forecastTemp = $("<label>");
                forecastTemp.text(((response1.list[i].main.temp-273.15) * 1.80 + 32).toFixed(0) + " F ");

            let forecastHumid = $("<label>");
                forecastHumid.text(" Humidity: " + response1.list[i].main.humidity)
                
            let forecast = $("<div class='forecastContainer'></div>");

            forecast.append(forecastDate).append(forecastImg).append(forecastTemp).append(forecastHumid);


            $(".forecast").append(forecast);
  

        } 

         // this sets the current weather
                // need to copy/create new variables for everything from line 97 to 119 but set it to index 0 for the response1.list loop
                let currentWeather = response1.list[0].weather[0];
                let currentDate = new Date(response1.list[0].dt * 1000).toLocaleDateString();
                    
                let today = $("<label>");
                    today.text(currentDate);

                let currentImg = $("<img>");
                    let todaysIcon = `http://openweathermap.org/img/wn/${currentWeather.icon}@2x.png`
                    currentImg.attr("src", todaysIcon)
                
                let currentTemp = $("<label>")
                    currentTemp.text(((response1.list[0].main.temp-273.15) * 1.80 + 32).toFixed(0) + " F ")

                let currentHumid = $("<label>");
                    currentHumid.text(" Humidity: " + response1.list[0].main.humidity)
                
                let currentWeatherDisplay = $("<div>Current Weather Conditions</div>")

                currentWeatherDisplay.append(currentWeather).append(currentImg).append(currentTemp).append(currentHumid)

                $("#current-weather").append(currentWeatherDisplay)
            
        
            // This sets the previous searched cities
            let cityName = $("#city-search").val()

            let searchedCities = $("<div class='capitalize'>")

            searchedCities.text(cityName)

            $("#searched-cities").append(searchedCities)

            let citiesList = JSON.parse(localStorage.getItem("cities")) || [];

            let newCity = {
                "cityName": cityName
            }

            citiesList.push(newCity);
            localStorage.setItem("cities", JSON.stringify(citiesList))

            showCities();

        return response1.city.coord
          
      }) 
            // This gives me the UV index
        .then(function(response2) {
            console.log(response2)
            let uvURL = `http://api.openweathermap.org/data/2.5/uvi?appid=${APIKey}&lat=${response2.lat}&lon=${response2.lon}`

     $.ajax({
         url: uvURL,
         method: "GET"
     })
        .then(function(response3){
        //    console.log(uvURL)
        //    console.log(response3)

        })

    })
      
      });
        // This allows the cities searched to show up after the page has been reloaded
      $(document).ready(function showCities(){
          let citiesList = JSON.parse(localStorage.getItem("cities")) || [];
          $("#searched-cities").empty();
          citiesList.forEach(function(citiesList){
            $("#searched-cities").append("<div class='capitalize'>" + citiesList.cityName + "</div>")
          });
      });

</script>

</body>

</html>

<!-- GIVEN a weather dashboard with form inputs
// Part I
// WHEN I search for a city
// THEN I am presented with current conditions for that city
    // and future conditions for that city---DONE
    // and that city is added to the search history---DONE


// WHEN I view current weather conditions for that city
// THEN I am presented with:
    //  the city name, the date, an icon representation of weather conditions, the temperature, the humidity, the wind speed, and the UV index

// WHEN I view the UV index
// THEN I am presented with a color that indicates whether the conditions are favorable, moderate, or severe

// WHEN I view future weather conditions for that city
// THEN I am presented with a 5-day forecast that displays the date, an icon representation of weather conditions, the temperature, and the humidity

// Part II
// WHEN I click on a city in the search history
// THEN I am again presented with current and future conditions for that city
// WHEN I open the weather dashboard
// THEN I am presented with the last searched city forecast -->